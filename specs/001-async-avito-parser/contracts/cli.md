# CLI Contract — Асинхронный обработчик объявлений Avito

## Команда запуска
```
python -m src.runner
```

### Конфигурация
Все параметры (пути `items_file`, `proxies_file`, строка подключения к БД, число воркеров, лимиты попыток, уровень логирования) задаются в файле `.env`, который загружается модулем `src/config.py`.

- CLI-аргументы не используются; изменения выполняются путём редактирования `.env`.
- При отсутствии `.env` используются значения по умолчанию из `config.py`.

## Стандартный вывод
- При старте: одна строка `runner_started` с количеством задач и воркеров.
- На каждую задачу: `task_status item_id=<id> status=<success|unavailable|error> proxy=<proxy>`.
- При блокировке прокси: `proxy_blocked address=<addr> reason=<code>`.
- При завершении: `runner_finished processed=<n> unavailable=<n> blocked=<n> retries=<n> duration=<sec>`.

## Коды выхода
| Код | Значение |
|-----|----------|
| 0 | Обработка завершилась успешно, все задачи пройдены. |
| 1 | Критическая ошибка запуска (конфиг, подключение к БД или Playwright). |
| 2 | Завершение по сигналу с незавершёнными задачами (возвращены в очередь). |

## Протокол работы воркера (из CLI точки зрения)
1. Runner публикует задачу через очередь и назначает воркеру.
2. Воркеры сообщают о смене состояния через стандартный вывод и обновления БД.
3. Любые ошибки возвращают задачу и логируются единичным сообщением.
