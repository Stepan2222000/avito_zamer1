# Research Log — Асинхронный обработчик объявлений Avito

## Decision: Использовать Python 3.13 с официальными Playwright- и asyncpg-библиотеками
- Rationale: Python 3.13 даёт улучшения по производительности asyncio и совместим с последними версиями Playwright/asyncpg; снижает технический долг по сравнению с более старыми версиями.
- Alternatives considered: Python 3.11 (стабильная LTS) — отклонён из-за желания использовать свежие async-оптимизации; Node.js Playwright — отклонён, т.к. вся остальная логика на Python.

## Decision: Поддерживать одну долговечную Playwright-страницу на воркер
- Rationale: Соответствует требованию минимизировать перезапуски контекстов и уменьшает риск блокировок; упрощает управление состоянием.
- Alternatives considered: Создавать новую страницу на каждый ID — усложняет и увеличивает вероятность бана; использовать несколько страниц на воркер — YAGNI для MVP.

## Decision: Реализовать кольцевой пул прокси через простую очередь в памяти и файлы `proxies.txt` / `blocked_proxies.txt`
- Rationale: KISS, нет внешних хранилищ; легко контролировать и отлаживать вручную.
- Alternatives considered: Redis/БД для прокси — избыточно; случайный выбор прокси — не гарантирует равномерное использование и сложнее исключать заблокированные.

## Decision: Автоматически создавать схему `new` и таблицу `new.listings` при старте
- Rationale: Устраняет ручные шаги перед запуском MVP и гарантирует корректную структуру; соответствует требованию автосоздания. (если уже созданы ранее - то не нужно)
- Alternatives considered: Документация с ручным DDL — риск человеческой ошибки; миграции Alembic — тяжелее для KISS.

## Decision: Минимизировать логи и метрики до компактных счётчиков и событий
- Rationale: Требование пользователя сократить объём логов; простые счётчики и единичные сообщения сохраняют наблюдаемость без шума.
- Alternatives considered: Полноценный стек (structured logging, Prometheus) — избыточно; отсутствие метрик — не даёт контроля стабильности.
